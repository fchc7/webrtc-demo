# WebRTC 测试流程指南

本文档介绍如何测试我们的 WebRTC 视频流应用程序。

## 准备工作

1. 确保你的环境中已安装 Node.js (推荐版本 14.x 或更高)
2. 克隆项目仓库并安装依赖：
   ```bash
   git clone <仓库URL>
   cd webrtc-demo
   npm install
   ```

## 启动服务器

1. 在项目根目录运行：

   ```bash
   node server.js
   ```

2. 服务器启动后，会在控制台显示三个不同的端口服务：
   - HTTP 会议服务器（端口 3000）
   - HTTPS 会议服务器（端口 3001）
   - HTTP 拉流服务器（端口 3002）

## 测试流程

### 步骤 1: 启动会议端（推流）

1. 在浏览器中打开会议端页面：

   - 如果是在本机测试，使用 `http://localhost:3000` 或 `https://localhost:3001`
   - 如果在局域网内测试，使用服务器启动时显示的 IP 地址

2. 在会议端页面：

   - 输入一个房间号（例如："test"）
   - 点击"加入房间"按钮
   - 允许摄像头和麦克风权限

3. 成功加入后，你会看到自己的视频预览，说明推流端已准备就绪

### 步骤 2: 启动拉流端（观看）

1. 在另一个浏览器或标签页中打开拉流端页面：

   - 输入 `http://localhost:3002` 或局域网 IP 加端口 3002

2. 在拉流端页面：

   - 输入与会议端相同的房间号（例如："test"）
   - 点击"加入房间"按钮

3. 连接建立后:

   - 如果自动播放成功，你将直接看到会议端的视频流
   - 如果由于浏览器策略限制无法自动播放，你需要点击页面中间的"点击播放"按钮

4. 此时，你应该能看到会议端的视频画面在 canvas 元素中显示

### 故障排除

如果你遇到连接问题：

1. **视频不显示**：

   - 检查两端输入的房间号是否完全一致
   - 检查会议端的摄像头是否正常工作
   - 在会议端和拉流端的控制台中查看是否有错误信息

2. **连接失败**：

   - 确保你的防火墙没有阻止 WebRTC 连接
   - 如果在局域网内测试，确保两台设备在同一网络

3. **音频问题**：
   - 如果没有声音，点击"取消静音"按钮

## 测试不同场景

1. **多用户测试**：

   - 打开多个拉流端页面，使用相同的房间号
   - 所有拉流端都应该能接收到相同的视频流

2. **离开/重新加入测试**：

   - 在拉流端点击"离开房间"，然后重新加入
   - 连接应该能够重新建立，视频流应该能够恢复

3. **会议端重连测试**：
   - 在视频流建立后，关闭会议端浏览器
   - 重新打开会议端并加入相同房间
   - 拉流端应该能自动重新连接并显示新的视频流

## 移动设备测试

1. 确保你的服务器可以通过局域网 IP 访问
2. 在移动设备上使用浏览器访问拉流端页面 (http://<服务器 IP>:3002)
3. 按照与电脑相同的步骤进行测试
4. 注意：不同移动浏览器的自动播放策略可能不同，可能需要点击"播放"按钮

## 完成测试

测试完成后，你可以按 Ctrl+C 停止服务器。
